<% provide(:title, @event.event_name)%>
<% provide(:meta_description, "See when everyone arrives at and departs from #{@event.event_name}.")%>

<% if current_user?(@event.user) %>
  <div class="row center">

  <%= form_for(:event, url: update_share_link_path, html: { class: "form-inline" } ) do |f| %>
    
    <div class="input-group">
      <%= link_to "<span class=\"glyphicon glyphicon-pencil\"></span> Edit #{@event.event_name} information".html_safe, edit_event_path(@event), class: "btn btn-primary" %> 
    </div>
    
    <div class="input-group">
      <div class="input-group-addon">
        Share:
      </div>
      <%= f.label :share_link, class: "sr-only" %>
      <%= f.text_field :share_link, class: "form-control", value: @share_link, style: "width: 450px" %>
    </div>
    <div class="input-group">
      <%= f.submit "Generate new share link", class: "btn btn-default", data: { confirm: "Are you sure you want to generate a new share link? Anyone with the current link will no longer be able to see this page." } %>
    </div>
    
  <% end %>
  </div>
<% end %>

<h1><%= @event.event_name %></h1>

<% if @event.note? %>
  <div class="alert alert-info event-info"><%= markdown_text(@event.note) %></div>
<% end %>

<%= @chart.draw %>

<hr />

<h2>Traveler Details</h2>

<% if @event.travelers.any? %>
	
  <% if current_user?(@event.user) %>
    <div class="button"><%= link_to("<span class=\"glyphicon glyphicon-plus\"></span> <span class=\"glyphicon glyphicon-user\"></span> Add new traveler".html_safe, new_traveler_path(event: @event), title: "Add a new traveler to #{@event.event_name}", class: "btn btn-default") %></div>
  <% end %>
  
  <% @event.flight_data_by_traveler.each do |traveler_id, traveler| %>
		<div class="row traveler-itinerary" id="t-<%= traveler_id %>">

      <div class="col-md-12 traveler-name">
        <% if current_user?(@event.user) %>
          <div class="btn-group edit-button">
            <%= link_to("<span class=\"glyphicon glyphicon-pencil\"></span> <span class=\"glyphicon glyphicon-user\"></span>".html_safe, edit_traveler_path(traveler_id), title: "Edit #{traveler[:traveler_name]}", class: "btn btn-default") %>
          </div>
        <% end %>   
  			<h3><%= traveler[:traveler_name] %>&ensp;<small><%= traveler[:traveler_note] %></small></h3>
        
  		</div>
		
  		<div class="col-md-6 traveler-flights">
        <h4>Arrival <small>at <%= @event.event_name %></small></h4>
        <%= render partial: "traveler_flights", locals: { traveler_id: traveler_id, traveler: traveler, direction: :arrivals } %>
        <% if traveler[:arrivals][:info] %>
          <div class="traveler-info"><%= traveler[:arrivals][:info] %></div>
        <% end %>
      </div>
    
      <div class="col-md-6 traveler-flights">
        <h4>Departure <small>from <%= @event.event_name %></small></h4>
        <%= render partial: "traveler_flights", locals: { traveler_id: traveler_id, traveler: traveler, direction: :departures } %>
        <% if traveler[:departures][:info] %>
          <div class="traveler-info"><%= traveler[:departures][:info] %></div>
        <% end %>
  		</div>
    
    </div>
	<% end %>
  
  <% if current_user?(@event.user) %>
    <div class="button"><%= link_to("<span class=\"glyphicon glyphicon-plus\"></span> <span class=\"glyphicon glyphicon-user\"></span> Add new traveler".html_safe, new_traveler_path(event: @event), title: "Add a new traveler to #{@event.event_name}", class: "btn btn-default") %></div>
  <% end %>

<% else %>

  <p>When travelers are added to this event, they will show up here.</p>

  <% if current_user?(@event.user) %>
    <div class="button"><%= link_to("<span class=\"glyphicon glyphicon-plus\"></span> <span class=\"glyphicon glyphicon-user\"></span> Add new traveler".html_safe, new_traveler_path(event: @event), title: "Add a new traveler to #{@event.event_name}", class: "btn btn-default") %></div>
  <% end %>

<% end %>