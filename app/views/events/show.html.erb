<% provide(:title, @event.event_name)%>
<% provide(:meta_description, "See when everyone arrives at and departs from #{@event.event_name}.")%>

<% if current_user?(@event.user) %>
  <div class="row center">

  <%= form_for(:event, url: update_share_link_path, html: { class: "form-inline" } ) do |f| %>
    
    <div class="input-group">
      <%= link_to "<span class=\"glyphicon glyphicon-pencil\"></span> Edit #{@event.event_name} information".html_safe, edit_event_path(@event), class: "btn btn-primary" %> 
    </div>
    
    <div class="input-group">
      <div class="input-group-addon">
        Share:
      </div>
      <%= f.label :share_link, class: "sr-only" %>
      <%= f.text_field :share_link, class: "form-control", value: @share_link, style: "width: 450px" %>
    </div>
    <div class="input-group">
      <%= f.submit "Generate new share link", class: "btn btn-default", data: { confirm: "Are you sure you want to generate a new share link? Anyone with the current link will no longer be able to see this page." } %>
    </div>
    
  <% end %>
  </div>
<% end %>

<h1><%= @event.event_name %></h1>

<% if @event.note? %>
  <div class="alert alert-info event-info"><%= markdown_text(@event.note) %></div>
<% end %>

<%= @chart.draw %>

<hr />

<h2>Flight Details</h2>

<% if @event.travelers.any? %>
<table class="table">
	<thead>
		<th class="event-traveler">Traveler</th>
		<th class="event-flights">Flights</th>
	</thead>
	<% @event.travelers.each do |traveler| %>
		<tr id="s-<%= traveler.id %>">
			
			<td>
				<span class="traveler-name"><%= traveler.traveler_name %></span>
        <% if current_user?(@event.user) %>
          <div class="btn-group-vertical edit-button">
            <%= link_to("<span class=\"glyphicon glyphicon-pencil\"></span> <span class=\"glyphicon glyphicon-user\"></span>".html_safe, edit_traveler_path(traveler), title: "Edit #{traveler.traveler_name}", class: "btn btn-default") %>
            <%= link_to("<span class=\"glyphicon glyphicon-plus\"></span> <span class=\"glyphicon glyphicon-plane\"></span>".html_safe, new_flight_path(traveler: traveler), title: "Add a new flight to #{traveler.traveler_name}â€™s itinerary", class: "btn btn-default") %>
          </div>
        <% end %>
        <br />
				<span class="traveler-note"><%= traveler.traveler_note %></span>
			</td>
			
			<td>
        <div>
          <h3>Arrival</h3>
          <%= render partial: "traveler_flights", locals: { flights: traveler.flights, is_arrival: true } %>
          <% if traveler.pickup_info %>
            <div><%= traveler.pickup_info %></div>
          <% end %>
        </div>
        <hr/>
        <div>
          <h3>Departure</h3>
          <%= render partial: "traveler_flights", locals: { flights: traveler.flights, is_arrival: false } %>
          <div>[Departure dropoff info]</div>
        </div>
        
			</td>
      
		</tr>
	<% end %>
</table>
<% end %>